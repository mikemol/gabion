---
doc_revision: 1
reader_reintern: Reader-only: re-intern if doc_revision changed since you last read this doc.
doc_id: in_37
doc_role: in_step
doc_scope:
  - repo
  - analysis
  - semantics
  - tooling
doc_authority: normative
doc_owner: maintainer
doc_requires:
  - POLICY_SEED.md#policy_seed
  - glossary.md#contract
  - glossary.md#aspf
  - glossary.md#forest
  - glossary.md#ambiguity_set
  - CONTRIBUTING.md#contributing_contract
  - README.md#repo_contract
  - AGENTS.md#agent_obligations
  - in/in-30.md#in_in_30
doc_reviewed_as_of:
  POLICY_SEED.md#policy_seed: 1
  glossary.md#contract: 1
  glossary.md#aspf: 1
  glossary.md#forest: 1
  glossary.md#ambiguity_set: 2
  CONTRIBUTING.md#contributing_contract: 1
  README.md#repo_contract: 1
  AGENTS.md#agent_obligations: 1
  in/in-30.md#in_in_30: 4
doc_review_notes:
  POLICY_SEED.md#policy_seed: Reviewed policy constraints; no conflict.
  glossary.md#contract: Reviewed semantic/reporting obligations.
  glossary.md#aspf: Reviewed call candidate carrier semantics.
  glossary.md#forest: Reviewed obligation materialization expectations.
  glossary.md#ambiguity_set: Reviewed ambiguity semantics for unresolved call targets.
  CONTRIBUTING.md#contributing_contract: Workflow constraints unchanged.
  README.md#repo_contract: Scope unchanged.
  AGENTS.md#agent_obligations: Agent obligations unchanged.
  in/in-30.md#in_in_30: Template reused.
doc_change_protocol: POLICY_SEED.md#change_protocol
doc_sections:
  in_in_37: 1
doc_section_requires:
  in_in_37:
    - POLICY_SEED.md#policy_seed
    - glossary.md#contract
    - glossary.md#ambiguity_set
    - in/in-30.md#in_in_30
doc_section_reviews:
  in_in_37:
    POLICY_SEED.md#policy_seed:
      dep_version: 1
      self_version_at_review: 1
      outcome: no_change
      note: "Execution-policy constraints preserved."
    glossary.md#contract:
      dep_version: 1
      self_version_at_review: 1
      outcome: no_change
      note: "Semantic reporting obligations preserved."
    glossary.md#ambiguity_set:
      dep_version: 2
      self_version_at_review: 1
      outcome: no_change
      note: "Ambiguity classification aligned with existing carrier terms."
    in/in-30.md#in_in_30:
      dep_version: 4
      self_version_at_review: 1
      outcome: no_change
      note: "Template constraints adopted."
---

<a id="in_in_37"></a>

# in/in-37.md
## Add explicit dynamic-dispatch uncertainty classification in call resolution

### Purpose
Distinguish unresolved calls caused by dynamic dispatch patterns from unresolved calls caused by missing/ambiguous static naming, and materialize that distinction in carrier evidence and reporting.

### Non-goals
- No new dynamic execution engine.
- No full object-shape inference for dynamic attribute lookups.
- No attempt to fully resolve monkeypatch/metaclass runtime behavior.

### Status
Done; call-resolution classification refinement is adopted.

Normative pointers: [POLICY_SEED.md#policy_seed](POLICY_SEED.md#policy_seed), [glossary.md#contract](glossary.md#contract), [glossary.md#ambiguity_set](glossary.md#ambiguity_set), [in/in-30.md#in_in_30](in/in-30.md#in_in_30).

---

## Face / Kit / Solver

### Face (obligations)
- **F1:** Call resolution outcomes explicitly separate dynamic-dispatch uncertainty from unresolved-internal naming issues.
- **F2:** `CallResolutionObligation` evidence encodes this classification.
- **F3:** Existing resolved/ambiguous behavior remains unchanged.
- **F4:** Reporting/lints clearly expose classification to avoid misleading remediation.

### Kit (existing machinery)
- `src/gabion/analysis/dataflow_audit.py`
  - `_resolve_callee`
  - `_resolve_callee_outcome`
  - `_materialize_call_candidates`
  - lint/report summarizers for obligations/ambiguities
- Forest carrier:
  - `CallCandidate`
  - `CallResolutionObligation`

### Solver (implementation plan)
1. **Extend resolution outcome taxonomy**
   - Add explicit status (e.g., `unresolved_dynamic`) to `_CalleeResolutionOutcome`.
   - Preserve existing statuses: resolved, ambiguous, unresolved_internal, unresolved_external.

2. **Dynamic-pattern classifier**
   - Add lightweight syntax classifier for call expressions likely requiring runtime dispatch:
     - `getattr(...)(...)`
     - indirect attribute chains with non-static receiver identity
     - selected assignment/rebinding patterns where target identity is not statically stable

3. **Thread classification into obligations**
   - In `_materialize_call_candidates`, emit `CallResolutionObligation` with `kind` distinguishing:
     - unresolved internal callee
     - unresolved dynamic dispatch

4. **Surface in lint/report**
   - Update summarization/lint formatting to show dynamic-dispatch category distinctly.
   - Ensure remediation text points to conservative expectation (not a missing symbol bug).

5. **Back-compat behavior**
   - Maintain prior handling for resolved/ambiguous edges and all existing tests not touching new category.

---

## Acceptance criteria

1. Dynamic-dispatch patterns are marked with dedicated unresolved-dynamic status.
2. Internal unresolved static names still map to unresolved-internal category.
3. `CallResolutionObligation` evidence includes stable `kind` suitable for CI/lint consumers.
4. Existing resolved and ambiguous call candidate behavior remains unchanged.
5. Reports/lints visibly distinguish the two unresolved classes.

---

## Test plan

- Add/extend tests near:
  - `tests/test_dataflow_resolve_callee.py`
  - `tests/test_dataflow_audit_coverage_gaps.py`
- Cases:
  - `getattr(obj, name)(x)` => unresolved_dynamic
  - known missing internal callee => unresolved_internal
  - plain resolvable call => resolved
  - multiply-matching callee => ambiguous
  - ensure `CallResolutionObligation` evidence kind is stable and asserted

---

## Risks and mitigations

- **Risk:** over-classification of ordinary unresolved calls as dynamic.
  - **Mitigation:** narrow syntax heuristic first; expand only with tests.
- **Risk:** reporting churn for downstream baselines.
  - **Mitigation:** document migration and provide stable status strings.
