---
doc_revision: 9
reader_reintern: Reader-only: re-intern if doc_revision changed since you last read this doc.
doc_id: in_25
doc_role: in_step
doc_scope:
  - repo
  - tooling
  - research
  - semantics
doc_authority: normative
doc_requires:
  - POLICY_SEED.md#policy_seed
  - glossary.md#contract
  - glossary.md#coherence_witness
  - glossary.md#deadness_witness
  - CONTRIBUTING.md#contributing_contract
  - README.md#repo_contract
  - AGENTS.md#agent_obligations
  - in/in-23.md#in_in_23
  - in/in-24.md#in_in_24
  - out/out-3.md#out_out_3
doc_reviewed_as_of:
  POLICY_SEED.md#policy_seed: 1
  glossary.md#contract: 1
  glossary.md#coherence_witness: 1
  glossary.md#deadness_witness: 1
  CONTRIBUTING.md#contributing_contract: 1
  README.md#repo_contract: 1
  AGENTS.md#agent_obligations: 1
  in/in-23.md#in_in_23: 1
  in/in-24.md#in_in_24: 1
  out/out-3.md#out_out_3: 1
doc_review_notes:
  POLICY_SEED.md#policy_seed: Reviewed POLICY_SEED.md rev1 (mechanized governance default; branch/tag CAS + check-before-use constraints); no conflicts with this document's scope.
  glossary.md#contract: Reviewed glossary.md#contract rev1 (glossary contract + semantic typing discipline).
  glossary.md#coherence_witness: Reviewed glossary.md#coherence_witness rev1 (coherence witness obligations + fork signature requirements).
  glossary.md#deadness_witness: Reviewed glossary.md#deadness_witness rev1 (deadness witness obligations for negative evidence artifacts).
  CONTRIBUTING.md#contributing_contract: Reviewed CONTRIBUTING.md rev1 (docflow now fails on missing GH references for SPPF-relevant changes); no conflicts with this document's scope.
  README.md#repo_contract: Reviewed README.md rev1 (docflow audit now scans in/ by default); no conflicts with this document's scope.
  AGENTS.md#agent_obligations: Agent obligations unchanged; coherence evidence remains advisory.
  in/in-23.md#in_in_23: Reviewed in/in-23.md rev7 (deadness witness pinning added); no conflicts.
  in/in-24.md#in_in_24: Reviewed in/in-24.md rev8 (deadness evidence scope preserved).
  out/out-3.md#out_out_3: ASPF/SPPF equivalence supports coherence witness framing.
doc_change_protocol: POLICY_SEED.md#change_protocol
doc_erasure:
  - formatting
  - typos
doc_owner: maintainer
doc_sections:
  in_in_25: 1
doc_section_requires:
  in_in_25:
    - POLICY_SEED.md#policy_seed
    - glossary.md#contract
    - glossary.md#coherence_witness
    - glossary.md#deadness_witness
    - CONTRIBUTING.md#contributing_contract
    - README.md#repo_contract
    - AGENTS.md#agent_obligations
    - in/in-23.md#in_in_23
    - in/in-24.md#in_in_24
    - out/out-3.md#out_out_3
doc_section_reviews:
  in_in_25:
    POLICY_SEED.md#policy_seed:
      dep_version: 1
      self_version_at_review: 1
      outcome: no_change
      note: Reviewed POLICY_SEED.md rev1 (mechanized governance default; branch/tag CAS + check-before-use constraints); no conflicts with this document's scope.
    glossary.md#contract:
      dep_version: 1
      self_version_at_review: 1
      outcome: no_change
      note: Reviewed glossary.md#contract rev1 (glossary contract + semantic typing discipline).
    glossary.md#coherence_witness:
      dep_version: 1
      self_version_at_review: 1
      outcome: no_change
      note: Reviewed glossary.md#coherence_witness rev1 (coherence witness obligations + fork signature requirements).
    glossary.md#deadness_witness:
      dep_version: 1
      self_version_at_review: 1
      outcome: no_change
      note: Reviewed glossary.md#deadness_witness rev1 (deadness witness obligations for negative evidence artifacts).
    CONTRIBUTING.md#contributing_contract:
      dep_version: 1
      self_version_at_review: 1
      outcome: no_change
      note: Reviewed CONTRIBUTING.md rev1 (docflow now fails on missing GH references for SPPF-relevant changes); no conflicts with this document's scope.
    README.md#repo_contract:
      dep_version: 1
      self_version_at_review: 1
      outcome: no_change
      note: Reviewed README.md rev1 (docflow audit now scans in/ by default); no conflicts with this document's scope.
    AGENTS.md#agent_obligations:
      dep_version: 1
      self_version_at_review: 1
      outcome: no_change
      note: Agent obligations unchanged; coherence evidence remains advisory.
    in/in-23.md#in_in_23:
      dep_version: 1
      self_version_at_review: 1
      outcome: no_change
      note: Reviewed in/in-23.md rev7 (deadness witness pinning added); no conflicts.
    in/in-24.md#in_in_24:
      dep_version: 1
      self_version_at_review: 1
      outcome: no_change
      note: Reviewed in/in-24.md rev8 (deadness evidence scope preserved).
    out/out-3.md#out_out_3:
      dep_version: 1
      self_version_at_review: 1
      outcome: no_change
      note: ASPF/SPPF equivalence supports coherence witness framing.
---
<a id="in_in_25"></a>


# in/in-25.md

## Branching and Coherence as First-Class Evidence

### Horn Fillers, Fracked Bifurcations, and Rewrite-Path Witnesses

---

## 0. Status

**Scope: formalization + artifactization of positive higher evidence.**

* `in-23.md` stabilizes **semantic carriers** (ASPF dimensional fingerprints), **positive provenance** (matches/mismatches with remainder), and **reproducible synth bases**.
* `in-24.md` stabilizes **negative evidence** (deadness witnesses) as first-class artifacts.

This step stabilizes the missing dual: **higher positive evidence**—explicit, structured witnesses of *internal branching* and its reconciliation at the surface interface. This is the “coherence” counterpart to deadness.

Normative pointers (explicit): [POLICY_SEED.md#policy_seed](POLICY_SEED.md#policy_seed), [glossary.md#contract](glossary.md#contract), [glossary.md#coherence_witness](glossary.md#coherence_witness), [glossary.md#deadness_witness](glossary.md#deadness_witness), [CONTRIBUTING.md#contributing_contract](CONTRIBUTING.md#contributing_contract), [README.md#repo_contract](README.md#repo_contract), [AGENTS.md#agent_obligations](AGENTS.md#agent_obligations), [in/in-23.md#in_in_23](in/in-23.md#in_in_23), [in/in-24.md#in_in_24](in/in-24.md#in_in_24), [out/out-3.md#out_out_3](out/out-3.md#out_out_3).

---

## 1. Goal

Make internal branching and reconciliation a **first-class semantic artifact** that:

* is produced by the audit pipeline,
* is reproducible in snapshots,
* is exposed via CLI + LSP,
* and is structured as evidence (not a prose explanation).

Equivalently:

> If `in-24` proves “no derivation exists,” `in-25` proves “multiple derivations exist here, and here is their coherent surface projection.”

This step is the bridge from “SPPF-equivalent labeling” to “SPPF-equivalent *derivation edges*.”

### Emergent lemma (existential witness)

Because carriers are finite and interned (`in-23` §0.2), a coherence witness is
an **existential claim**: there exists more than one derivation sharing the same
surface boundary. Operationally, the witness projection is non‑empty, forming
the existential dual to deadness.

---

## 2. Definitions (minimal, repo-native)

### 2.1 Branch point (internal bifurcation)

A **BranchPoint** is an internal location where the analysis admits at least two semantically admissible derivation alternatives that project to the same surface semantic boundary (same carrier class at the interface).

Internal synthesis point:

* your existing “detect internal branching and expose the precise bifurcation signal’s projection on the surface interface,” iteratively fracking layers between the branch point and the surface.

### 2.2 Coherence witness (positive higher evidence)

A **CoherenceWitness** is an explicit witness that two derivation candidates share a surface boundary while differing internally.

Normative content:

* `site`: `(path, function, bundle)` (same anchor as provenance/deadness)
* `boundary`: the surface semantic boundary claimed common (typically base/ctor carriers, plus synth epoch context)
* `alternatives`: two (or more) alternative derivation descriptors
* `fork_signature`: stable identifier for “where they diverge” (internal, may be abstracted)
* `frack_path`: the layer sequence used to lift the fork to the surface (evidence of the lifting, not the full trace)
* `result`: `COHERENT` or `UNKNOWN` (UNKNOWN must not be coerced to coherent)
* `remainder`: if reconciliation is partial, remainder must be explicit

### 2.3 Horn / filler framing (operational)

A **Horn** is a partially-specified surface explanation (e.g., “these match, but why?”).
A **Filler** is the minimal witness completing that explanation (the coherence witness).

This is not category theory cosplay. It is the repo’s operational stance:

* do not postulate coherence globally;
* compute it when demanded;
* preserve it as an artifact.

### 2.4 Coherence artifact

`fingerprint_coherence.json` is the serialized list of `CoherenceWitness` entries.

It is the positive higher-evidence sibling of:

* `fingerprint_provenance.json` (site-level boundary evidence)
* `fingerprint_deadness.json` (site-level emptiness evidence)

---

## 3. Why coherence must be an artifact (not implied by matching)

A glossary match or identical base carrier does not imply that:

* the internal derivation is unique, or
* the internal divergence is explainable, or
* the divergence is refactorable.

Without explicit coherence evidence, the system cannot distinguish:

* “same boundary, coherent alternatives” (valid packed node), from
* “same boundary, unresolved ambiguity” (unknown), from
* “same boundary, mismatch hidden by lossy projection” (bug).

Therefore, coherence must be surfaced as evidence. If the system cannot construct a witness, it must say `UNKNOWN` and include remainder/trail markers—not pretend.

---

## 4. Face / Kit / Solver (repo idiom)

### 4.1 Face (obligations)

**C1 — Evidence, not assertion**
Any claim that “multiple derivations exist here” must be accompanied by a CoherenceWitness entry.

**C2 — Boundary explicitness**
The shared boundary must be explicit (base/ctor keys, synth epoch, and any constraints relevant to equivalence).

**C3 — Fork localization (anti-elision)**
The witness must include a stable fork signature and a frack path: the minimal layer sequence that explains how the fork projects to the boundary.

**C4 — Determinism and ordering**
Coherence artifacts must be deterministic across runs given the same basis + inputs.

**C5 — Snapshot reproducibility**
Audit snapshots must capture coherence artifacts so coherence diffs are meaningful.

**C6 — Interface parity**
CLI, LSP, and report must surface the same coherence information.

**C7 — Non-conflation**
`UNKNOWN` coherence is distinct from `COHERENT`; unresolved ambiguity must not be silently treated as valid equivalence.

### 4.2 Kit (available machinery)

Already present by internal synthesis point:

* dimensional fingerprints + provenance keys
* synth bases (save/load)
* branching detection + fracking projection concept
* report plumbing patterns (as used for synth/provenance/deadness)
* snapshot capture + latest selectors
* determinism habits + tests-as-lemmas

### 4.3 Solver (how obligations are discharged)

Extend the audit pipeline with a coherence phase:

1. Identify candidate branch points (where alternative derivations are admitted).
2. For each branch point, iteratively frack:

   * compute the minimal layer sequence linking fork to surface boundary,
   * extract the smallest distinguishing descriptors of alternatives.
3. Emit:

   * report section: **Coherence evidence**
   * JSON: `fingerprint_coherence.json`
4. Plumb through:

   * CLI and LSP response
   * snapshot capture scripts
   * latest snapshot selectors

Coherence is computed only where demanded by analysis signals, to avoid global postulation.

---

## 5. Artifact contract

### 5.1 Required artifacts (when enabled)

* `fingerprint_coherence.json`
* report section: **Coherence evidence**
* LSP field: `fingerprint_coherence` (or equivalent naming)

### 5.2 Schema obligations (normative, minimal)

Each entry must include:

* `site`: `path`, `function`, `bundle`
* `boundary`:

  * `base_keys`
  * `ctor_keys`
  * `synth_version` (if relevant)
  * `basis_id` or basis identity marker (hash‑consed canonical payload) if present
* `alternatives`: list of at least 2 descriptors (stable, not raw traces)
* `fork_signature`: stable fork identifier (internal origin)
* `frack_path`: ordered layer tags (the path of lifting)
* `result`: `COHERENT|UNKNOWN`
* `remainder`: explicit if partial

Ordering:

* sort by `(path, function, bundle, fork_signature)`.

---

## 6. Determinism and replay

Coherence determinism requires:

* stable ordering of alternative descriptors,
* stable fork signature computation,
* stable frack path ordering (canonical layer naming).

If any component cannot be stabilized, the witness must be `UNKNOWN` and include remainder/trail markers. No silent approximation.

---

## 7. Checks as lemmas (tests → obligations)

Introduce tests analogous to prior steps:

* **Coherence entry existence** (C1):

  * for a known branch scenario, ensure at least one witness exists

* **Boundary explicitness** (C2):

  * witness includes boundary base/ctor keys and synth context where applicable

* **Fork localization** (C3):

  * witness includes fork_signature and frack_path non-empty

* **Determinism** (C4):

  * same inputs produce byte-identical JSON (timestamps discouraged)

Acceptance mapping: see `docs/matrix_acceptance.md` for the minimum test suite
and schema obligations derived from the 3×3×3 matrix.

Docflow audit remains required.

---

## 8. Snapshot integration (required)

Extend snapshot tooling:

* `audit_snapshot.sh` writes `fingerprint_coherence.json` when enabled
* `latest_snapshot.sh`:

  * selector `--fingerprint-coherence`
  * lists the file by default when present

Coherence is part of the semantic audit record once the detector exists.

---

## 9. Relation to SPPF and homotopy view (contract-level)

With `in-23` and `in-24`, the system has:

* boundary evidence (provenance),
* basis evidence (synth),
* emptiness evidence (deadness).

This step adds:

* **packed-alternative evidence** (coherence witnesses).

SPPF mapping completeness (operational):

* packed node boundary is a fingerprint boundary,
* packed alternatives are coherence entries,
* pruned alternatives are deadness entries.

In higher-path language:

* a coherence witness is a 2-cell candidate (path between paths),
* fracking computes the minimal filler needed to justify surface equality.

We do not require full higher coherence closure here; we require artifactized witnesses where branching is detected.

---

## 10. Minimal success criteria

This step is complete when:

1. `fingerprint_coherence.json` exists, is snapshot-captured, and is surfaced via CLI + LSP.
2. Each coherence claim includes:

   * explicit boundary (base/ctor, synth context)
   * fork signature + frack path
   * explicit remainder/UNKNOWN handling
3. Determinism is enforced by tests (byte-identical artifacts across runs).
4. Coherence does not silently swallow unresolved ambiguity.

---

## 11. Homology of this document (explicit self-audit)

This document extends the chain complex from `in-23`/`in-24`:

* **C₀**: boundary objects (base/ctor/synth contexts at sites)
* **C₁**: alternative derivation descriptors (1-cells candidates)
* **C₂**: coherence witnesses (2-cells / fillers)
* **∂**: tests mapping witnesses back to obligations
* **H₀**: semantic classes at the boundary (already stabilized)
* **H₁**: alternative-derivation loops (branching that returns to same boundary)
* **H₂**: coherence surfaces (filled horns; what remains invariant under fracking)

“holes” correspond to unfilled horns: surfaced equality without an obtainable coherence witness. These must appear as `UNKNOWN`, not as false certainty.

---

## 12. Orthogonal implication braid (3×3×3, concise)

### N₁ CoherenceWitness

* I₁.1 **Soundness**: COHERENT implies alternatives share boundary semantics

  * I₁.1.a boundary keys must agree (base/ctor)
  * I₁.1.b synth context must agree or be explicitly bridged
  * I₁.1.c remainder must be empty or explicit
* I₁.2 **Explainability**: witness is reconstructible and minimal

  * I₁.2.a fork_signature identifies divergence site
  * I₁.2.b frack_path shows lifting layers
  * I₁.2.c alternative descriptors are stable and comparable
* I₁.3 **Reproducibility**: witness is stable under rerun

  * I₁.3.a stable ordering
  * I₁.3.b stable fork signature algorithm
  * I₁.3.c stable frack path canonicalization

### N₂ Fracking

* I₂.1 **Locality**: lift only what’s needed to justify boundary claim

  * I₂.1.a avoid dumping full traces
  * I₂.1.b preserve minimal distinguishing facts
  * I₂.1.c explicit remainder when minimality is not achieved
* I₂.2 **Layer discipline**: each layer has a stable name/role

  * I₂.2.a base/ctor/synth/prov layers are explicit
  * I₂.2.b attribute environments are referenced when relevant
  * I₂.2.c layer skipping is forbidden without explanation
* I₂.3 **Interplay**: coherence interacts with deadness and provenance

  * I₂.3.a dead branches are not alternatives
  * I₂.3.b provenance entries link boundary to site
  * I₂.3.c coherence witnesses compose with provenance evidence

### N₃ Artifactization

* I₃.1 **Pipeline parity**: CLI/LSP/report agree

  * I₃.1.a same entries, stable IDs
  * I₃.1.b projection differences are formatting-only
  * I₃.1.c UNKNOWN is preserved across surfaces
* I₃.2 **Snapshot capture**: artifacts are durable and diffable

  * I₃.2.a included in audit snapshots
  * I₃.2.b discoverable via latest selectors
  * I₃.2.c basis identity pinned when “LATEST” is involved
* I₃.3 **Audit semantics**: evidence is obligation, not hint

  * I₃.3.a missing coherence artifact = incomplete proof
  * I₃.3.b tests assert presence and determinism
  * I₃.3.c failures are explicit, not rounded

---

## 13. Commands (reference)

### Local checks

* `python -m pytest -q`
* `mise exec -- python scripts/docflow_audit.py --root .`

### Audit with coherence artifact

* `gabion dataflow-audit --fingerprint-coherence-json <path> ...`

### Snapshot capture

* `./audit_snapshot.sh`
* `./latest_snapshot.sh --fingerprint-coherence`

(Flags must match repo CLI; this section is normative and must be kept aligned with implementation.)

---

## 14. Closing

`in-25` completes the evidence triad around packed derivations:

* `in-23`: boundary carriers + provenance + synth basis
* `in-24`: deadness (emptiness) evidence
* `in-25`: coherence (branching) evidence

Together these yield an attribute-grammar–complete packed forest:

* derivations exist (provenance),
* derivations don’t exist (deadness),
* multiple derivations exist and reconcile (coherence),
* all as reproducible, snapshot-captured, interface-visible artifacts.

This is the minimal foundation required before attempting:

* automated rewrite suggestions as proof-carrying transformations,
* coherence closure libraries beyond witnessed horns,
* and explicit dimension genesis beyond `synth@k`.
