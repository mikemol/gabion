---
doc_revision: 1
reader_reintern: Reader-only: re-intern if doc_revision changed since you last read this doc.
doc_id: in_18
doc_role: inbox
doc_scope:
  - repo
  - inbox
doc_authority: informative
doc_owner: maintainer
doc_requires:
  - POLICY_SEED.md#policy_seed
  - glossary.md#decision_surface
  - glossary.md#value_encoded_decision
  - glossary.md#tier
  - glossary.md#decision_table
  - glossary.md#decision_bundle
  - glossary.md#decision_protocol
  - README.md#repo_contract
  - CONTRIBUTING.md#contributing_contract
  - AGENTS.md#agent_obligations
doc_reviewed_as_of:
  POLICY_SEED.md#policy_seed: 1
  glossary.md#decision_surface: 1
  glossary.md#value_encoded_decision: 1
  glossary.md#tier: 1
  glossary.md#decision_table: 1
  glossary.md#decision_bundle: 1
  glossary.md#decision_protocol: 1
  README.md#repo_contract: 1
  CONTRIBUTING.md#contributing_contract: 1
  AGENTS.md#agent_obligations: 1
doc_review_notes:
  POLICY_SEED.md#policy_seed: Reviewed POLICY_SEED.md rev1 (mechanized governance default; branch/tag CAS + check-before-use constraints); no conflicts with this document's scope.
  glossary.md#decision_surface: Reviewed glossary.md#decision_surface rev1 (decision surface tier boundary semantics).
  glossary.md#value_encoded_decision: Reviewed glossary.md#value_encoded_decision rev1 (value-encoded decision surface semantics).
  glossary.md#tier: Reviewed glossary.md#tier rev1 (tier evidence thresholds + promotion requirements).
  glossary.md#decision_table: Reviewed glossary.md#decision_table rev1 (decision table tier definition).
  glossary.md#decision_bundle: Reviewed glossary.md#decision_bundle rev1 (decision bundle tier definition).
  glossary.md#decision_protocol: Reviewed glossary.md#decision_protocol rev1 (decision protocol tier definition).
  README.md#repo_contract: Reviewed README.md rev1 (docflow audit now scans in/ by default); no conflicts with this document's scope.
  CONTRIBUTING.md#contributing_contract: Reviewed CONTRIBUTING.md rev1 (docflow now fails on missing GH references for SPPF-relevant changes); no conflicts with this document's scope.
  AGENTS.md#agent_obligations: Agent obligations unchanged; value-encoded decision semantics align with glossary tiers.
doc_change_protocol: POLICY_SEED.md#change_protocol
doc_erasure:
  - formatting
  - typos
doc_sections:
  in_in_18: 1
doc_section_requires:
  in_in_18:
    - POLICY_SEED.md#policy_seed
    - glossary.md#decision_surface
    - glossary.md#value_encoded_decision
    - glossary.md#tier
    - glossary.md#decision_table
    - glossary.md#decision_bundle
    - glossary.md#decision_protocol
    - README.md#repo_contract
    - CONTRIBUTING.md#contributing_contract
    - AGENTS.md#agent_obligations
doc_section_reviews:
  in_in_18:
    POLICY_SEED.md#policy_seed:
      dep_version: 1
      self_version_at_review: 1
      outcome: no_change
      note: Reviewed POLICY_SEED.md rev1 (mechanized governance default; branch/tag CAS + check-before-use constraints); no conflicts with this document's scope.
    glossary.md#decision_surface:
      dep_version: 1
      self_version_at_review: 1
      outcome: no_change
      note: Reviewed glossary.md#decision_surface rev1 (decision surface tier boundary semantics).
    glossary.md#value_encoded_decision:
      dep_version: 1
      self_version_at_review: 1
      outcome: no_change
      note: Reviewed glossary.md#value_encoded_decision rev1 (value-encoded decision surface semantics).
    glossary.md#tier:
      dep_version: 1
      self_version_at_review: 1
      outcome: no_change
      note: Reviewed glossary.md#tier rev1 (tier evidence thresholds + promotion requirements).
    glossary.md#decision_table:
      dep_version: 1
      self_version_at_review: 1
      outcome: no_change
      note: Reviewed glossary.md#decision_table rev1 (decision table tier definition).
    glossary.md#decision_bundle:
      dep_version: 1
      self_version_at_review: 1
      outcome: no_change
      note: Reviewed glossary.md#decision_bundle rev1 (decision bundle tier definition).
    glossary.md#decision_protocol:
      dep_version: 1
      self_version_at_review: 1
      outcome: no_change
      note: Reviewed glossary.md#decision_protocol rev1 (decision protocol tier definition).
    README.md#repo_contract:
      dep_version: 1
      self_version_at_review: 1
      outcome: no_change
      note: Reviewed README.md rev1 (docflow audit now scans in/ by default); no conflicts with this document's scope.
    CONTRIBUTING.md#contributing_contract:
      dep_version: 1
      self_version_at_review: 1
      outcome: no_change
      note: Reviewed CONTRIBUTING.md rev1 (docflow now fails on missing GH references for SPPF-relevant changes); no conflicts with this document's scope.
    AGENTS.md#agent_obligations:
      dep_version: 1
      self_version_at_review: 1
      outcome: no_change
      note: Agent obligations unchanged; value-encoded decision semantics align with glossary tiers.
---

<a id="in_in_18"></a>

# in-18: Algebraic Decision Surfaces and Value-Encoded Control Detection

## Problem

In branchless programming styles—common in security-sensitive code, SIMD-optimized code, and performance-critical routines—conditional behavior is encoded through arithmetic operations such as `min`, `max`, multiplication with boolean-like expressions, and bitmasking. These structures intentionally avoid explicit branching for performance or timing side-channel reasons.

While effective, this approach creates a **semantic opacity** problem: control flow exists, but is no longer syntactically exposed. This causes Gabion’s standard grammar and decision-surface analysis to miss critical structural boundaries, tier violations, or glossary-aligned decision points.

Normative pointers (explicit): [POLICY_SEED.md#policy_seed](POLICY_SEED.md#policy_seed), [glossary.md#decision_surface](glossary.md#decision_surface),
[glossary.md#value_encoded_decision](glossary.md#value_encoded_decision), [glossary.md#tier](glossary.md#tier), [glossary.md#decision_table](glossary.md#decision_table),
[glossary.md#decision_bundle](glossary.md#decision_bundle), [glossary.md#decision_protocol](glossary.md#decision_protocol), [README.md#repo_contract](README.md#repo_contract),
[CONTRIBUTING.md#contributing_contract](CONTRIBUTING.md#contributing_contract), [AGENTS.md#agent_obligations](AGENTS.md#agent_obligations).

## Goals

* Detect value-encoded decision surfaces in algebraic or branchless constructs.
* Restore implicit control structure as a first-class analysis artifact.
* Warn on tiered glossary term use within nonlinear constructs.
* Enable refactor output to optionally “rebranch” such logic for clarity.

## Proposed Approach

1. **Extend Grammar Analysis with Nonlinear Decision Heuristics**

   * Introduce `is_value_encoded_decision(node: Expr) -> bool` in grammars.
   * Detect patterns like:

     * `min(a, b)`
     * `a * (cond)` or `b + (flag * delta)`
     * `(cond & mask)` or `(cond << shift)`
   * Flag expressions where conditional influence is algebraically embedded.

2. **Integrate Glossary Awareness**

   * If glossary keys appear in nonlinear contexts (e.g. `security_mode` in `*`, `//`, etc.), surface a semantic warning.
   * Allow glossary tier rules to apply regardless of syntactic structure.

3. **Emit Rebranch Suggestions**

   * Synthesis pass can optionally emit equivalent `if`-based logic for human readability (configurable).
   * Useful in documentation contexts or early-stage refactor reviews.

4. **Audit Trail and Diff Support**

   * Allow value-encoded decision points to be surfaced in CI grammar reports.
   * Enable tracking of added/removed nonlinear control regions across commits.

## Example

Code:

```python
a = (user_mode == "admin") * elevated_value + (user_mode != "admin") * normal_value
```

Gabion emits:

```
✓ Detected value-encoded decision surface using 'user_mode'
✓ Tier 2 glossary term 'user_mode' used in nonlinear conditional context
✓ Suggest refactoring to explicit branch for clarity or boundary elevation
```

Optional rewrite:

```python
if user_mode == "admin":
    a = elevated_value
else:
    a = normal_value
```

## Dependencies

* Expression grammar access (e.g. `Expr` tree node types)
* Glossary tier enforcement engine (from in-15)
* Optional: rewrite engine or expression normalizer

## Acceptance Criteria

* Grammar detects at least one min/max or bitmask-based control flow
* Glossary term tier violation surfaces even without `if`
* CLI flag enables value-decision audit or refactor synthesis
* CI output shows value-encoded surface count and location

---

Proposed by: branchless audit discussion
Related: in-15 (tiered surfaces), in-16 (diffing), in-17 (subtree reuse)
Status: draft