---
doc_revision: 4
reader_reintern: "Reader-only: re-intern if doc_revision changed since you last read this doc."
doc_id: in_31
doc_role: in_step
doc_scope:
  - repo
  - tooling
  - semantics
  - analysis
doc_authority: normative
doc_requires:
  - POLICY_SEED.md#policy_seed
  - glossary.md#contract
  - glossary.md#aspf
  - glossary.md#forest
  - glossary.md#suite_site
  - glossary.md#hash_consing
  - glossary.md#evidence_surface
  - CONTRIBUTING.md#contributing_contract
  - README.md#repo_contract
  - AGENTS.md#agent_obligations
  - in/in-30.md#in_in_30
doc_reviewed_as_of:
  POLICY_SEED.md#policy_seed: 1
  glossary.md#contract: 1
  glossary.md#aspf: 1
  glossary.md#forest: 1
  glossary.md#suite_site: 1
  glossary.md#hash_consing: 1
  glossary.md#evidence_surface: 1
  CONTRIBUTING.md#contributing_contract: 1
  README.md#repo_contract: 1
  AGENTS.md#agent_obligations: 1
  in/in-30.md#in_in_30: 2
doc_review_notes:
  POLICY_SEED.md#policy_seed: "Reviewed POLICY_SEED.md rev1 (mechanized governance default; branch/tag CAS + check-before-use constraints); no conflicts with this document's scope."
  glossary.md#contract: "Reviewed glossary.md#contract rev1 (semantic typing discipline)."
  glossary.md#aspf: "Reviewed glossary.md#aspf rev1 (carrier semantics + packed-forest labels)."
  glossary.md#forest: "Reviewed glossary.md#forest rev1 (materialized carrier and interned identity)."
  glossary.md#suite_site: "Reviewed glossary.md#suite_site rev1 (locality carrier + containment semantics)."
  glossary.md#hash_consing: "Reviewed glossary.md#hash_consing rev1 (internment = normalize)."
  glossary.md#evidence_surface: "Reviewed glossary.md#evidence_surface rev1 (evidence surface as set)."
  CONTRIBUTING.md#contributing_contract: "Reviewed CONTRIBUTING.md rev1 (docflow + workflow guardrails)."
  README.md#repo_contract: "Reviewed README.md rev1 (repo scope + entry points)."
  AGENTS.md#agent_obligations: "Agent obligations unchanged; carrier formalization aligned."
  in/in-30.md#in_in_30: "Reviewed in/in-30.md#in_in_30 v2 (SuiteSite unifying carrier)."
doc_change_protocol: POLICY_SEED.md#change_protocol
doc_erasure:
  - spelling/formatting only
  - reflow without semantic edits
  - comment-only changes
doc_owner: maintainer
doc_sections:
  in_in_31: 3
doc_section_requires:
  in_in_31:
    - POLICY_SEED.md#policy_seed
    - glossary.md#contract
    - glossary.md#aspf
    - glossary.md#forest
    - glossary.md#suite_site
    - glossary.md#hash_consing
    - glossary.md#evidence_surface
    - CONTRIBUTING.md#contributing_contract
    - README.md#repo_contract
    - AGENTS.md#agent_obligations
    - in/in-30.md#in_in_30
doc_section_reviews:
  in_in_31:
    POLICY_SEED.md#policy_seed:
      dep_version: 1
      self_version_at_review: 3
      outcome: no_change
      note: "Policy seed reviewed; carrier formalization unchanged."
    glossary.md#contract:
      dep_version: 1
      self_version_at_review: 3
      outcome: no_change
      note: "Glossary contract reviewed; semantic typing discipline unchanged."
    glossary.md#aspf:
      dep_version: 1
      self_version_at_review: 3
      outcome: no_change
      note: "ASPF carrier semantics reviewed; formalization aligned."
    glossary.md#forest:
      dep_version: 1
      self_version_at_review: 3
      outcome: no_change
      note: "Forest materialization reviewed; internment assumptions aligned."
    glossary.md#suite_site:
      dep_version: 1
      self_version_at_review: 3
      outcome: no_change
      note: "SuiteSite locality carrier reviewed; projection linkage aligned."
    glossary.md#hash_consing:
      dep_version: 1
      self_version_at_review: 3
      outcome: no_change
      note: "Hash-consing reviewed; internment = normalize preserved."
    glossary.md#evidence_surface:
      dep_version: 1
      self_version_at_review: 3
      outcome: no_change
      note: "Evidence surface reviewed; report observables aligned."
    CONTRIBUTING.md#contributing_contract:
      dep_version: 1
      self_version_at_review: 3
      outcome: no_change
      note: "Contributor contract reviewed; no workflow conflicts."
    README.md#repo_contract:
      dep_version: 1
      self_version_at_review: 3
      outcome: no_change
      note: "Repo contract reviewed; scope unchanged."
    AGENTS.md#agent_obligations:
      dep_version: 1
      self_version_at_review: 3
      outcome: no_change
      note: "Agent obligations reviewed; formalization aligned."
    in/in-30.md#in_in_30:
      dep_version: 2
      self_version_at_review: 3
      outcome: no_change
      note: "SuiteSite carrier reviewed; projection formalization builds on it."
---
<a id="in_in_31"></a>

# in/in-31.md
## ProjectionSpec, Internment, ASPF, and Reports as a Unified Structure

### Purpose
Formalize the relationship between **ProjectionSpec**, **internment**, **ASPF/Forest**, and **reports/inputs** as a single higher‑order object with a quotient (evidence‑erasing) projection and a gauge‑fixing inverse.

### Non-goals
- This step does **not** change projection operators.
- This step does **not** alter SuiteSite migration sequencing.
- Implementation changes are **additive only** (proof-of-concept specs/facets).

---

## Status
- Formalization of existing behavior and intended invariants.
- Aligns ProjectionSpec-as-carrier with SuiteSite and hash-consing semantics.
- Proof-of-concept: suite-order projection materialized as SpecFacet.

### Compact implementation ledger
- **Implemented**
  - `src/gabion/analysis/dataflow_audit.py::_materialize_suite_order_spec` reifies suite-order quotient rows into SpecFacet-compatible projection rows, grounding the proof-of-concept carrier path (SPPF: in-30 checklist row, GH-85).
  - `src/gabion/analysis/projection_registry.py` registers `ProjectionSpec(name="suite_order", domain="suite_order")`, making suite-order quotient output addressable from report projection plumbing (SPPF: in-30 checklist row, GH-85).
- **Open**
  - A dedicated quotient/internment regression harness for the `suite_order` carrier path is still not codified as a named test contract in `tests/` (SPPF: in-30 checklist row, GH-85).
- **Blocked/Deferred**
  - Internal broad-type lint tightening on non-boundary surfaces is tracked separately and may constrain final carrier proof shape once enforced repo-wide (`src/gabion/analysis/dataflow_audit.py::_internal_broad_type_lint_lines`) (SPPF: checklist internal broad-type lint row, GH-89).

Normative pointers (explicit): [POLICY_SEED.md#policy_seed](POLICY_SEED.md#policy_seed), [glossary.md#contract](glossary.md#contract), [glossary.md#aspf](glossary.md#aspf), [glossary.md#forest](glossary.md#forest), [glossary.md#suite_site](glossary.md#suite_site), [glossary.md#hash_consing](glossary.md#hash_consing), [glossary.md#evidence_surface](glossary.md#evidence_surface), [CONTRIBUTING.md#contributing_contract](CONTRIBUTING.md#contributing_contract), [README.md#repo_contract](README.md#repo_contract), [AGENTS.md#agent_obligations](AGENTS.md#agent_obligations), [in/in-30.md#in_in_30](in/in-30.md#in_in_30).

---

## Definitions

- **Carrier (ASPF/Forest):** The interned evidence graph $F \in \mathcal{F}$.
- **ProjectionSpec:** A typed quotient rule $s \in \mathcal{S}$.
- **Report/Observables:** The evidence‑erased output $R \in \mathcal{R}$.
- **Internment:** A spec‑indexed gauge‑fixing inverse selecting a canonical representative.

---

## Face / Kit / Solver

### Face (Obligations)

- **F1:** ProjectionSpec is a quotient morphism that erases evidence:
  $$
  \pi_s : \mathcal{F} \to \mathcal{R}
  $$
- **F2:** Internment is the gauge‑fixing inverse:
  $$
  \pi_s(\iota_s(R)) = R
  $$
- **F3:** Internment defines a canonical normal form:
  $$
  \iota_s(\pi_s(F)) \equiv \mathrm{canon}_s(F)
  $$
- **F4:** SpecFacet reifies the quotient inside the carrier as an evidence‑bearing relation.

### Kit (Existing machinery)

- ASPF/Forest internment via hash‑consing.
- ProjectionSpec and projection execution.
- SpecFacet as a carrier‑anchored facet.
- SuiteSite as locality carrier.

### Solver (Implementation plan)

1. Treat ProjectionSpec as a quotient in documentation and tests.
2. Treat internment as canonical lift (normal form) in carrier semantics.
3. Use SpecFacet to witness quotient outputs inside the carrier.
4. Preserve SuiteSite locality as the semantic scaffold for projection facets.
5. Materialize suite-order spec facets to validate quotient reification.

---

## Formalization

### Quotient (ProjectionSpec)
For a spec $s$:
$$
\pi_s(F) = R
$$
where $R$ retains only observables and erases witness detail.

### Gauge‑Fixing Inverse (Internment)
Internment selects a canonical representative for each $R$:
$$
\iota_s : \mathcal{R} \to \mathcal{F}, \quad \pi_s(\iota_s(R)) = R
$$

### Canonical Normal Form
$$
\iota_s(\pi_s(F)) \equiv \mathrm{canon}_s(F)
$$
so that internment produces a gauge‑invariant carrier (hash‑consed normal form
under the spec's erasure boundary).

### SpecFacet (Reification)
SpecFacet is the reified witness of the quotient:
$$
\phi_s(F): \mathrm{SpecSite}(s) \to \mathrm{SuiteSite}/\mathrm{FunctionSite}(F)
$$
carrying the projected row evidence.

### Evidence Erasure and Composition (Inverse Projection)
ProjectionSpec erases evidence to form observables. Its inverse is a **family of
lifts** (free variables) constrained by the carrier. Composition corresponds to
intersecting those witness spaces.

- **Forward (quotient):** $F \xrightarrow{\pi_s} R$ (erase evidence).
- **Inverse (lifts):** $R \xrightarrow{\iota_s} \{F \mid \pi_s(F)=R\}$.
- **Composition:** $\iota_{s_2}(\pi_{s_1}(F))$ refines the witness space and
  corresponds to constraint intersection, not a single inverse.

---

## Reports and Inputs

- **Inputs** generate the carrier:
  $$
  \mathrm{input} \xrightarrow{\mathrm{analyze}} F
  $$
- **Reports** are quotients:
  $$
  F \xrightarrow{\pi_s} R
  $$
- **Re‑internment** produces canonical carrier fragments:
  $$
  R \xrightarrow{\iota_s} F_R
  $$

---

## Admissibility

- **Admissible:**
  - New ProjectionSpecs that define clear observables.
  - Re‑internment of projection outputs into SpecFacet.
- **Inadmissible:**
  - Projection outputs without a SpecFacet witness.
  - Internment that depends on non‑canonical ordering.

---

## Checks as Lemmas

- **L1:** Spec hash identifies a unique quotient rule.
- **L2:** SpecFacet ties each report row to a carrier site.
- **L3:** Re‑internment is stable under re‑audit (idempotent).

---

## Success Criteria

- Projection outputs re‑intern deterministically as SpecFacet.
- Internment produces stable canonical carriers across runs.
- SuiteSite locality remains the scaffold for projection facets.

---

## Failure Modes and Diagnostics

- **FM1:** Projection output changes without carrier change (spec hash constant) → nondeterminism in quotient.
- **FM2:** SpecFacet missing → report is disconnected from carrier.
- **FM3:** Internment diverges on re‑audit → broken canonicalization.

---

## Commands
(Optional; illustrative)

```bash
mise exec -- python -m gabion check
```

---

## Appendix A: One‑Line Summary (Operational)
$$
\mathrm{input} \xrightarrow{\mathrm{analyze}} F \xrightarrow{\pi_s} R \xrightarrow{\iota_s} \mathrm{canon}_s(F)
$$
